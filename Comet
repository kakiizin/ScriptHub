local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Comet",
    SubTitle = "",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Auto = Window:AddTab({ Title = "Auto", Icon = "play" })
}

-- Variáveis de Controle
local Config = {
    AutoRifle = false,
    AutoJuzo = false,
    TargetRange = 2000,
    StepSize = 10, -- Passos curtos de 10 studs (Bem abaixo do Threshold de 120)
    StepWait = 0.1, -- Pequena pausa para o servidor processar a posição
    SafeHeight = 400
}

-- Serviços
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Remotes
local gunFunctions = ReplicatedStorage:WaitForChild("Events"):WaitForChild("GunManager"):WaitForChild("gunFunctions")
local gunManager = ReplicatedStorage:WaitForChild("Events"):WaitForChild("GunManager")
local skillRemote = ReplicatedStorage:WaitForChild("Events"):WaitForChild("Skill")
local takeStam = ReplicatedStorage:WaitForChild("Events"):WaitForChild("takestam")

-- Funções Auxiliares de Combate
local function hasScriptInside(model)
    for _, child in ipairs(model:GetDescendants()) do
        if child:IsA("Script") or child:IsA("LocalScript") or child:IsA("ModuleScript") then return true end
    end
    return false
end

local function getTarget()
    local closest, dist = nil, Config.TargetRange
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Humanoid") and obj.Parent and obj.Parent:IsA("Model") and obj.Health > 0 then
            local model = obj.Parent
            if not Players:GetPlayerFromCharacter(model) and model:FindFirstChild("Head") and hasScriptInside(model) then
                local d = (char.HumanoidRootPart.Position - model.Head.Position).Magnitude
                if d < dist then dist = d closest = model.Head end
            end
        end
    end
    return closest
end

-- Função de Movimentação Stealth (Passo a Passo)
-- Esta função substitui o Tween e o Teleporte para evitar o erro "TP Check"
local function stealthMove(targetCFrame)
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return false end
    local hrp = char.HumanoidRootPart
    
    local startPos = hrp.Position
    local endPos = targetCFrame.Position
    local distance = (startPos - endPos).Magnitude
    local steps = math.ceil(distance / Config.StepSize)
    
    for i = 1, steps do
        if not hrp or not hrp.Parent or not Config.AutoJuzo then return false end
        
        local nextPos = startPos:Lerp(endPos, i / steps)
        hrp.CFrame = CFrame.new(nextPos)
        
        -- Envia o Dash para mascarar o movimento
        pcall(function() takeStam:FireServer(1, "dash") end)
        
        task.wait(Config.StepWait)
    end
    return true
end

-- Loop Auto Rifle Simples
task.spawn(function()
    while true do
        if Config.AutoRifle and not Config.AutoJuzo then
            local target = getTarget()
            if target then
                pcall(function()
                    gunFunctions:InvokeServer("reload", { Gun = "Rifle" })
                    task.wait(0.05)
                    gunManager:FireServer("fire", {
                        Start = CFrame.lookAt(player.Character.HumanoidRootPart.Position, target.Position),
                        Gun = "Rifle",
                        joe = "true",
                        Position = target.Position
                    })
                end)
            end
        end
        task.wait(0.15)
    end
end)

-- Loop Auto Juzo (V8 - Stealth Movement)
task.spawn(function()
    while true do
        if Config.AutoJuzo then
            local char = player.Character
            local hrp = char and char:FindFirstChild("HumanoidRootPart")
            
            if hrp then
                pcall(function()
                    -- 1. Preparação: Sky Walk + Subida Stealth para 400 studs
                    skillRemote:InvokeServer("Sky Walk2", {
                        char = char,
                        cf = hrp.CFrame * CFrame.new(0, 10, 0)
                    })
                    task.wait(0.1)
                    
                    local highPos = hrp.CFrame * CFrame.new(0, Config.SafeHeight, 0)
                    stealthMove(highPos)
                    task.wait(0.2)

                    -- 2. Ir para Posição 1 (Movimento Stealth Horizontal)
                    local pos1_high = CFrame.new(1760.85242, Config.SafeHeight + 9.82812977, -10489.0752)
                    local success = stealthMove(pos1_high)
                    
                    if not success or not char:FindFirstChild("HumanoidRootPart") then return end

                    -- 3. Descer Stealth para a Posição 1 Real
                    local pos1_real = CFrame.new(1760.85242, 9.82812977, -10489.0752)
                    stealthMove(pos1_real)
                    task.wait(0.2)

                    -- 4. Reload e Espera 0.5s
                    gunFunctions:InvokeServer("reload", { Gun = "Rifle" })
                    task.wait(0.5)

                    -- 5. Sky Walk 2
                    skillRemote:InvokeServer("Sky Walk2", {
                        char = char,
                        cf = CFrame.new(1765.7352294921875, 17.062767028808594, -10489.6767578125, 0, 1, -0, 0, -0, -1, -1, 0, -0)
                    })
                    task.wait(0.2)

                    -- 6. Teleporte Curto para Posição 2 (Stealth)
                    if char:FindFirstChild("HumanoidRootPart") then
                        stealthMove(CFrame.new(1765.56335, 57.0781345, -10528.8643))
                    else return end
                    task.wait(0.15)

                    -- 7. Atirar (Gun Rifle na Cabeça)
                    local target = getTarget()
                    if target and char:FindFirstChild("HumanoidRootPart") then
                        gunManager:FireServer("fire", {
                            Start = CFrame.lookAt(char.HumanoidRootPart.Position, target.Position),
                            Gun = "Rifle",
                            joe = "true",
                            Position = target.Position
                        })
                    end
                    task.wait(0.2)

                    -- 8. Sky Walk 2 novamente
                    skillRemote:InvokeServer("Sky Walk2", {
                        char = char,
                        cf = CFrame.new(1765.7352294921875, 17.062767028808594, -10489.6767578125, 0, 1, -0, 0, -0, -1, -1, 0, -0)
                    })
                    task.wait(0.15)

                    -- 9. Retorno Stealth para Posição 1
                    if char:FindFirstChild("HumanoidRootPart") then
                        stealthMove(CFrame.new(1760.85242, 9.82812977, -10489.0752))
                    end
                end)
            end
        end
        task.wait(0.1)
    end
end)

-- Interface
Tabs.Auto:AddToggle("AutoRifle", {
    Title = "Auto Rifle",
    Default = false,
    Callback = function(Value) Config.AutoRifle = Value end
})

Tabs.Auto:AddToggle("AutoJuzo", {
    Title = "Auto Juzo",
    Default = false,
    Callback = function(Value) Config.AutoJuzo = Value end
})

Window:SelectTab(1)
Fluent:Notify({ Title = "Comet", Content = "Script V8 (Stealth Mode) Carregado!", Duration = 5 })
